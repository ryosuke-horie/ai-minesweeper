# ADR-001: テスト戦略

## ステータス
承認済み

## コンテキスト
AI Minesweeperは、Go言語で実装されたTUIアプリケーションである。効果的なテスト戦略を定義し、品質を保証しながら開発効率を最大化する必要がある。

TUIアプリケーションのテストには以下の課題がある：
- 画面出力の検証が複雑
- ユーザー入力のシミュレーションが困難
- 非同期処理（AIの思考時間）のテストが難しい

## 決定事項

### テストレベルと優先度

1. **ユニットテスト（優先度: 高）**
   - 対象：ゲームロジック、AIソルバーのアルゴリズム
   - カバレッジ目標：80%以上
   - 実装場所：`*_test.go`ファイル

2. **統合テスト（優先度: 中）**
   - 対象：Model/Update/Viewの連携、ゲームフロー
   - カバレッジ目標：主要なユーザーシナリオをカバー
   - 実装場所：`integration_test.go`

3. **E2Eテスト（優先度: 低）**
   - 対象：重要なユーザーシナリオのみ
   - 実装：当面は見送り、必要に応じて再検討

### テスト対象の詳細

#### ユニットテスト
```
game/
├── cell_test.go      # セルの状態管理
├── board_test.go     # 盤面操作、地雷配置
└── game_test.go      # ゲーム状態管理

solver/
└── solver_test.go    # AIの推論ロジック
```

#### 統合テスト
- ゲーム開始から終了までのフロー
- AIソルバーとゲームロジックの連携
- 難易度切り替えの動作

## 根拠

### ユニットテストを最優先にする理由
1. **実装が簡単** - 標準のtestingパッケージで十分
2. **実行が高速** - ミリ秒単位で実行可能
3. **デバッグが容易** - 問題の特定が簡単
4. **ROIが高い** - 少ない労力で大きな効果

### E2Eテストを低優先度にする理由
1. **実装コストが高い** - teatestやptyの設定が複雑
2. **実行時間が長い** - 画面描画やアニメーションの待機
3. **メンテナンスコストが高い** - UIの変更で頻繁に修正が必要
4. **不安定になりやすい** - タイミング依存の問題

### 統合テストを中優先度にする理由
1. **重要な連携をカバー** - コンポーネント間の相互作用を検証
2. **ユニットテストの限界を補完** - 実際の使用に近い状況をテスト
3. **実装コストが適度** - E2Eより簡単、ユニットテストより包括的

## 結果

### ポジティブな結果
- 高速なフィードバックループ
- 安定したテストスイート
- 効率的な開発プロセス
- CIでの実行が容易

### ネガティブな結果
- 実際のユーザー体験の一部がテストされない
- 画面表示の問題を見逃す可能性
- 手動テストが必要な部分が残る

## 参考資料
- [Testing Bubble Tea Programs](https://github.com/charmbracelet/bubbletea/tree/master/examples)
- [Go Testing Best Practices](https://go.dev/doc/tutorial/add-a-test)
- [Test Pyramid](https://martinfowler.com/articles/practical-test-pyramid.html)